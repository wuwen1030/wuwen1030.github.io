<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=0.5.0" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Ben's Homepage">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Ben's Homepage">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ben's Homepage">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> Ben's Homepage </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Ben's Homepage</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">君子善假于物</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/23/WWDC2016之初识Xcode-Source-Editor-Extension/" itemprop="url">
                  WWDC2016之初识Xcode Source Editor Extension
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-23T20:01:19+08:00" content="2016-06-23">
              2016-06-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/23/WWDC2016之初识Xcode-Source-Editor-Extension/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/23/WWDC2016之初识Xcode-Source-Editor-Extension/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>以往Xcode插件开发在没有官方支持的情况下，基本处于处于刀耕火种的状态。虽然后来有了<a href="https://github.com/kattrali/Xcode-Plugin-Template" target="_blank" rel="external">Xcode-Plugin-Template</a>和各种dump好的头文件，我们仍然需要在没有文档的情况下做各种猜测和hook。关于插件的开发，可以看看<a href="https://onevcat.com/2013/02/xcode-plugin/" target="_blank" rel="external">这篇文章</a>。幸运的是苹果终于注意到了这一需求，并在<a href="https://developer.apple.com/videos/wwdc2016/" target="_blank" rel="external">WWDC2016</a>上发布这一新特性–<code>Xcode Source Editor Extension</code>。</p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p><code>Xcode Source Editor Extension</code>，从字面意思理解就是Xcode源代码编辑器的一个扩展，事实上它的命名的确很好地反映了它的功能和定位。那么基于这项技术我们究竟能做什么呢？<a href="https://developer.apple.com/videos/play/wwdc2016/414/" target="_blank" rel="external">WWDC session 414</a>给我们的答案是：</p>
<blockquote>
<p>Add commands to the source editor</p>
<p>Edit text</p>
<p>Change selections</p>
</blockquote>
<p>给Xcode的代码编辑器扩展一些命令（在<code>Editor</code>菜单下增加额外的菜单），通过这些命令对源代码进行编辑（包括整个文件和选中的部分，这里的selection我起初不理解，后面做Demo就会理解了）。</p>
<p>相比于以往的插件开发，<code>Xcode Source Editor Extension</code>具有以下特点：</p>
<ul>
<li>稳定。extension运行在其独立的进程中，插件的崩溃不会再引起Xcode的崩溃了。</li>
<li>安全。extension拥有自己的sandBox，而且不会直接去操作Xcode工程，而是由Xcode将text以invocation的方式传递。</li>
<li>快速。每个extension在Xcode启动后会即会被异步地以XPC的方式加载。</li>
<li>简单。苹果提供了官方支持。</li>
</ul>
<p>此外，作为<code>App Extension</code>的一种，可在App Store发布，优秀的插件也可以为开发者增加收入。下面我们就跟着demo来探究如何实现一个<code>Xcode Source Editor Extension</code>。</p>
<h3 id="工程创建"><a href="#工程创建" class="headerlink" title="工程创建"></a>工程创建</h3><p>我将创建一个为全部选中行添加注释的demo。根据官方指导，创建一个插件工程非常容易。首先我们创建一个<code>Cocoa Application</code>命名为”XTExtension”，接着在<code>Application Extension</code>中选中<code>Xcode Source Editor Extension</code>，命名为<code>XTComment</code>。<br><img src="https://raw.githubusercontent.com/wuwen1030/blogresources/master/extension_template.png" alt="extension template"><br>此时工程的<code>XTComment</code>目录下有两个文件<code>SourceEditorExtension.swift</code>和<code>SourceEditorCommand.swfit</code>，<code>SourceEditorExtension</code>用来管理extension的生命周期相关，<code>SourceEditorCommand</code>则用来处理具体的命令。Extension的加载和处理流程如下：<br><img src="https://raw.githubusercontent.com/wuwen1030/blogresources/master/flow.png" alt="flow"><br>Xcode的启动时候会记载所有的extension，并保证它们的生命周期。当用户点击选择命令按钮后，Xcode会以invocation的形式通知到extension，extension做出相应的处理并把处理结果回调给Xcode。<code>SourceEditorExtension.swift</code>的方法<code>extensionDidFinishLaunching</code>在extension被加载时调用，可以在这里做一些初始化的工作。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">extensionDidFinishLaunching</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// If your extension needs to do any work at launch, implement this optional method.</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Extension launched..."</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="添加菜单"><a href="#添加菜单" class="headerlink" title="添加菜单"></a>添加菜单</h3><p>打开<code>Info.plist</code>，展开<code>NSExtension</code>至<code>XCSourceEditorCommandDefinitions</code>，命令菜单的定义如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>NSExtensionAttributes<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>XCSourceEditorCommandDefinitions<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span>&gt;</span>XCSourceEditorCommandClassName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">string</span>&gt;</span>$(PRODUCT_MODULE_NAME).SourceEditorCommand<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span>&gt;</span>XCSourceEditorCommandIdentifier<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">string</span>&gt;</span>com.xt.APPlugins.AutoComment.SourceEditorCommand<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span>&gt;</span>XCSourceEditorCommandName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">string</span>&gt;</span>Source Editor Command<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">key</span>&gt;</span>XCSourceEditorExtensionPrincipalClass<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">string</span>&gt;</span>$(PRODUCT_MODULE_NAME).SourceEditorExtension<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其中：</p>
<ul>
<li><code>XCSourceEditorCommandClassName</code>指向命令的处理类，该类实现<code>XCSourceEditorCommand</code>。</li>
<li><code>XCSourceEditorCommandIdentifier</code>是命令的唯一标识，通常我们会对一组命令设置同一个<code>XCSourceEditorCommand</code>，在invocation中获取此标识做区分处理。</li>
<li><code>XCSourceEditorCommandName</code>是命令在菜单栏展示的菜单名称。</li>
</ul>
<p>此外，菜单项是动态加载的，可以实现<code>SourceEditorExtension</code>的<code>commandDefinitions:</code>实现，但是这会覆盖掉<code>Info.plist</code>中的定义。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> commandDefinitions: [[<span class="type">XCSourceEditorCommandDefinitionKey</span>: <span class="type">AnyObject</span>]] &#123;</span><br><span class="line">    <span class="comment">// If your extension needs to return a collection of command definitions that differs from those in its Info.plist, implement this optional property getter.</span></span><br><span class="line">    <span class="keyword">return</span> [[.classNameKey: <span class="string">"SourceEditorCommand"</span>,</span><br><span class="line">             .identifierKey: <span class="string">"CustomIdentifier"</span>,</span><br><span class="line">             .nameKey: <span class="string">"CustomeName"</span>]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Extension的菜单会默认加载在<code>Show Code Coverage</code>下。编译运行，选取Xcode-Beta作为Lanuching App，点击<code>Editor</code>，然而<code>Show Code Coverage</code>下空空如也，什么也没有。作为新主题，可查的资料实在太少，一度以为因为Xcode是Beta版的问题并打算放弃了。很偶然的一个机会在<a href="http://adcdownload.apple.com/WWDC_2016/Xcode_8_beta/Release_Notes_for_Xcode_8_beta.pdf" target="_blank" rel="external">Xcode 8.0 beta Release Notes</a>看到了这个问题的答案，WTF！</p>
<blockquote>
<p>To use Xcode Extensions on macOS 10.11 El Capitan, you must first launch Xcode and let it install additional system components. Then, in Terminal, run sudo /usr/libexec/xpccachectl.<br>Once the operation completes, restart your Mac. (26106213)</p>
</blockquote>
<h3 id="业务实现"><a href="#业务实现" class="headerlink" title="业务实现"></a>业务实现</h3><p>打开<code>SourceEditorCommand.swift</code>，实现<code>perform(with:completionHandler:)</code>。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">perform</span><span class="params">(with invocation: XCSourceEditorCommandInvocation, completionHandler: <span class="params">(NSError?)</span></span></span> -&gt; <span class="type">Void</span> ) -&gt; <span class="type">Void</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> lineIndexes = [<span class="type">Int</span>]()</span><br><span class="line">    <span class="keyword">for</span> range <span class="keyword">in</span> invocation.buffer.selections &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> range = range <span class="keyword">as</span>? <span class="type">XCSourceTextRange</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> start = range.start</span><br><span class="line">        <span class="keyword">let</span> end = range.end</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> start.line...end.line &#123;</span><br><span class="line">            lineIndexes.append(i)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    lineIndexes.<span class="built_in">reverse</span>()</span><br><span class="line">    <span class="keyword">for</span> lineNumber <span class="keyword">in</span> lineIndexes &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> line = invocation.buffer.lines[lineNumber] <span class="keyword">as</span>? <span class="type">NSString</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> commentLine = <span class="type">NSString</span>(format: <span class="string">"// %@"</span>, line)</span><br><span class="line">        invocation.buffer.lines.insert(commentLine, at: lineNumber)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Implement your command here, invoking the completion handler when done. Pass it nil on success, and an NSError on failure.</span></span><br><span class="line">    completionHandler(<span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>invocation</code>的<code>buffer</code>提供了比较丰富的信息，包括文件的<code>lines</code>, <code>selections</code>, <code>indentationWidth</code>等等，具体作用可以查看<a href="https://developer.apple.com/videos/play/wwdc2016/414/" target="_blank" rel="external">WWDC视频</a>或者苹果的文档查看，在此就不一一介绍了。<br><img src="https://raw.githubusercontent.com/wuwen1030/blogresources/master/feature_show.png" alt="feature show"><br>此外，需要注意的一点是，苹果希望文本的编辑是快速流畅的，如果你的处理的文本时间过长苹果就会为用户提供一个取消的入口，这会触发invocation的<code>cancellationHandler</code>，所以在这里终止你的耗时的工作，否则你的extension可能不能正常地工作。最后，附上苹果的extension开发建议。</p>
<blockquote>
<p>Start up quickly</p>
<p>Use GCD and follow standard asynchronous patterns</p>
<p>Don’t replace the whole buffer if you don’t have to</p>
<p>Handle cancellation quickly</p>
</blockquote>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><code>Xcode Source Editor Extension</code>提供了一种官方Xcode插件开发方法，从上文可以看出，其所涉及的类和函数都很少，非常容易上手。同时，从目前来看，她的能力还相对较弱，一些复杂的如<a href="https://github.com/FuzzyAutocomplete/FuzzyAutocompletePlugin" target="_blank" rel="external">FuzzyAutocompletePlugin</a>还无法实现。但我相信很快会有优秀的插件来丰富Xcode功能和提升开发效率的。</p>
<p><a href="https://github.com/wuwen1030/XTExtension" target="_blank" rel="external">Demo</a></p>
<p>参考</p>
<ul>
<li><a href="https://developer.apple.com/videos/play/wwdc2016/414/" target="_blank" rel="external">WWDC session 414</a></li>
<li><a href="https://github.com/cyanzhong/xTextHandler" target="_blank" rel="external">xTextHandler</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/17/查找Xcode工程未使用的图片资源/" itemprop="url">
                  查找Xcode工程未使用的图片资源
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-17T11:49:36+08:00" content="2016-03-17">
              2016-03-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/03/17/查找Xcode工程未使用的图片资源/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/03/17/查找Xcode工程未使用的图片资源/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>随着<code>APP</code>的功能越来越丰富，安装包的尺寸也在快速增长。像16G这种在往日非常大的存储空间，现在也越来越捉襟见肘，安装包的大小已经成为衡量<code>APP</code>质量的指标之一。分析iOS的安装包文件.ipa文件我们可以看到，图片资源在安装包中还是占了比较大的比重，通过减少图片的总尺寸可以达到我们的目的。方法有两个，一是压缩单张图片的尺寸，比较著名的有<a href="https://imageoptim.com/" target="_blank" rel="external">imageOptim</a>，二是减少图片的数量。实际上在我们的开发过程中，由于业务和设计的快速变化，导致工程中有许多冗余的图片资源。我们的目标就是找出并删除这些冗余的图片。为此，开发了工具<a href="https://github.com/wuwen1030/find-unused-images" target="_blank" rel="external"><code>UnusedImagesFinder</code></a>。</p>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>使用方法自然是相当简单的，打开你的Terminal，执行以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python unused_images_finder.py PROJECT_PATH &#123;SOURCE_PATH&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>PROJECT_PATH</code>是你的工程文件的路径，也就是<code>.xcodeproj</code>文件的路径。<code>SOURCE_PATH</code>是一个可选参数，一般设置为工程的根目录，默认为<code>.xcodeproj</code>文件的上级目录。检查的结果写入到当前目录下的<code>result.txt</code>文件中。按照上述的步骤执行，如果在<code>result.txt</code>文件中发现一堆误杀的文件，这时你就需要注意了，可能你的代码不是以常规的<code>imageNamed:@&quot;xxx&quot;</code>的形式引用的。此时，我们需要修改我们的源文件了，打开<code>ununsed_images_finder</code>找到174行，看到如下的代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imageReferencePatterns = [re.compile(<span class="string">r".*imageNamed:@\"([^@\.]+)(@\dx)*(\.png|\.jpg)*\".*"</span>)]</span><br></pre></td></tr></table></figure>
<p>根据工程中引用图片的方式可以定制正则表达式，加入数组或者替换掉即可。</p>
<h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><p>大致的实现思路如下：</p>
<ul>
<li><p><strong>找出图片资源</strong></p>
<p>  在使用脚本中有一个参数是必填的，这个参数就是<code>.xcodeproj</code>，为什么一定要这个参数呢？因为在它的目录里有一个重要的文件<code>project.pbxproj</code>，这个文件包含了工程所有的构建信息，包括图片资源和编译源文件。打开<code>project.pbxproj</code>，找到<code>Begin PBXResourcesBuildPhase section</code>和<code>End PBXResourcesBuildPhase section</code>之间的内容，这里就是工程所引用的资源，这里有一些<code>plist</code>，还有我们想要找的图片文件。通过正则匹配，我们可以拿到图片的名称。最初的版本，我就是这么写的，运行结果出来后，发现有非常多的漏查。查找后发现，工程中部分图片被放到<code>.bundle</code>文件中，其中的文件并不会出现在<code>project.pbxproj</code>，类似的还有<code>image.xcasset</code>中的图片资源。所以在这里改变策略，遍历整个工程，找出所有图片。</p>
</li>
<li><p><strong>找出源文件</strong></p>
<p>  有了图片的查找经验，找资源文件就很简单了，所有被编译的资源都在<code>project.pbxproj</code>里的<code>Begin PBXBuildFile section</code>和<code>End PBXBuildFile section</code>之间。为什么我们不是在遍历文件时找出所有源文件呢？因为我们有许多不好的习惯，很多时候没用的源文件只是简单地被从工程引用中移除，并没有被物理删除。如果我们把这部分文件也加进来，它们引用的图片将成为漏网之鱼。</p>
</li>
<li><p><strong>扫描未引用的图片资源</strong></p>
<p>  有了上面两步的工作，第三步就比较简单了。遍历项目中的源文件，通过正则匹配的方式找到已引用的图片（注意，正则可能需要使用者补充，见使用方法），剩下的自然就是未被引用的资源了。</p>
</li>
</ul>
<h3 id="已知问题和改进"><a href="#已知问题和改进" class="headerlink" title="已知问题和改进"></a>已知问题和改进</h3><p>当前存在的不足如下：</p>
<ul>
<li>目前不支持<code>Storyboard</code>和<code>xib</code></li>
<li><p>引用如果没有直接使用文件名，无法检测出，比如</p>
<pre><code class="objc"><span class="built_in">NSString</span> *imageName = <span class="string">@"imageName"</span>;
<span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:imageName];
...
<span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageNamed:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"xxx%d"</span>, <span class="number">2</span>]]
</code></pre>
</li>
<li><p>误杀</p>
<ul>
<li>Icon, Default 等文件不会直接被代码引用，查找的时候会被误杀</li>
<li>问题二的文件同样会被误杀</li>
</ul>
</li>
</ul>
<p>未来改进的方向：</p>
<ul>
<li>改进上面的问题</li>
<li>脚本集成到持续集成中</li>
<li>提高检测率</li>
</ul>
<p><strong>最最最重要的一点，删除图片之前做好确认工作！</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/05/20/2015-05-20-at-ibdesignable-suo-jian-ji-suo-de-de-custom-view/" itemprop="url">
                  @IBDesignable-所见即所得的Custom View
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-05-20T15:02:52+08:00" content="2015-05-20">
              2015-05-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/05/20/2015-05-20-at-ibdesignable-suo-jian-ji-suo-de-de-custom-view/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/05/20/2015-05-20-at-ibdesignable-suo-jian-ji-suo-de-de-custom-view/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>iOS8发布后，XCode对自定义控件支持有所加强，之前在途牛旅游客户端开发了一个通用的控件<code>TNStepper</code>，这篇文章主要通过升级<code>TNStepper</code>来简单介绍这项新技术<strong><code>@IBDesignable</code> <code>@IBInspectable</code></strong>。</p>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>在iOS的开发中，对于一些具备独立功能的可复用的控件我们往往会把它做成一个自定的控件（<code>custom view</code>）。使用控件时，我们调用<code>initWithFrame:</code>方法创建控件，对于<code>storyboard/xib</code>，我们通过在<code>storyboard/xib</code>拖拽一个<code>UIView</code>控件（要求自定义控件实现<code>initWithCoder:</code>方法），并将其<code>Class</code>指定为<code>MyCustomView</code>。我们看到的一个空白的<code>view</code>，并不是我们设计好的<code>custom view</code>，根本没有发挥<code>storyboard/xib</code>所见即所得优势，也没法动态去看到<code>custom view</code>属性调整后的效果。</p>
<h3 id="IBDesignable实时渲染"><a href="#IBDesignable实时渲染" class="headerlink" title="@IBDesignable实时渲染"></a>@IBDesignable实时渲染</h3><p>本文使用<code>Swift</code>编写了<code>TNStepper</code>的升级版<a href="https://github.com/wuwen1030/VisualStepper" target="_blank" rel="external">VisualStepper</a>，通过该控件来简单介绍这项新技术，读者可先行下载代码。其中，<code>XTStepper</code>为我们的自定义View。</p>
<p>首先简单介绍一下<code>XTStepper</code>的代码，</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">init</span>(frame: <span class="type">CGRect</span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</span><br><span class="line">    xibSetup()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">required</span> <span class="keyword">init</span>(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(coder: aDecoder)</span><br><span class="line">    xibSetup()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">xibSetup</span><span class="params">()</span></span> &#123;</span><br><span class="line">    view = loadViewFromNib()</span><br><span class="line">    <span class="comment">// Add constraint here</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">self</span>.updateApperance()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadViewFromNib</span><span class="params">()</span></span> -&gt; <span class="type">UIView</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> bundle = <span class="type">NSBundle</span>(forClass: <span class="keyword">self</span>.<span class="keyword">dynamicType</span>)</span><br><span class="line">    <span class="keyword">let</span> nib = <span class="type">UINib</span>(nibName: <span class="string">"XTStepper"</span>, bundle: bundle)</span><br><span class="line">    <span class="keyword">let</span> view = nib.instantiateWithOwner(<span class="keyword">self</span>, options: <span class="literal">nil</span>)[<span class="number">0</span>] <span class="keyword">as</span>! <span class="type">UIView</span></span><br><span class="line">    <span class="keyword">return</span> view</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>作为一个重度的<code>storyboard/xib</code>使用者，我是不希望自己去手写创建代码的，控件里的子view都是<code>XTStepper.xib</code>创建的，通过<code>func loadViewFromNib() -&gt; UIView</code>加载。这样做的好处就是所见即所得，而且我们不用写那些繁琐的constraint。<code>XTStepper.xib</code>长这个样子。</p>
<p><img src="https://raw.githubusercontent.com/wuwen1030/blogresources/master/20150520_01.png" alt="image01"></p>
<p>打开<code>Main.storyboard</code>文件，却发现一片空白，完全看不到我们设计好的控件的样子。<br>我们所需要做的很简单，只要在我们希望实时渲染的自定义控件前加上<code>@IBDesignable</code>关键字即可。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="meta">@IBDesignable</span> <span class="class"><span class="keyword">class</span> <span class="title">XTStepper</span>: <span class="title">UIControl</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在让我们来见证一下它的魔力。</p>
<p><img src="https://raw.githubusercontent.com/wuwen1030/blogresources/master/20150520_02.png" alt="image02"></p>
<p>虽然只有加一个关键字这么简单，我们仍然要注意，因为从<code>storyboard</code>创建<code>ViewController</code>调用的是这个初始化方法，我们一定要覆写<code>init(coder aDecoder: NSCoder)</code>，做初始化工作。现在控件已经是我们所希望看到的样子了，但这还不够。<code>UIStepper</code>是可以动态调整相关的属性，来控制控件的状态的，我们也想要<code>VisulStepper</code>一样好用。</p>
<h3 id="IBInspectable动态更新"><a href="#IBInspectable动态更新" class="headerlink" title="@IBInspectable动态更新"></a>@IBInspectable动态更新</h3><p>我们为<code>VisualStepper</code>添加三个类似于<code>TNStepper</code>的属性，当前值<code>value</code>、<code>maxinumValue</code>和<code>minmumValue</code>，当这几个值发生变化的时候，控件的<code>+``-</code>的可用状态会发生变化。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func updateApperance()&#123;</span><br><span class="line">    valueLabel.text = String(value)</span><br><span class="line">    minusButton.enabled = value &gt; minmumValue &amp;&amp; value &lt;= maxinumValue</span><br><span class="line">    plusButton.enabled = value &gt;= minmumValue &amp;&amp; value &lt; maxinumValue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们希望可以在<code>InterfaceBuilder</code>里设置这些属性，方法很简单，在属性前加上<code>@IBInspectable</code>。我们可以看到刚才定义的几个属性，在这里我们可以设置他们的值。<br>在设置的时候，我们发现控件的状态不会变化，即使<code>value &lt;= minumValue</code>了，<code>-</code>仍然是可以点击的状态，因此我们需要在检测到值变化的时候，去更新我们控件的状态。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@IBInspectable</span> <span class="keyword">var</span> value:<span class="type">Int</span> = <span class="number">0</span> &#123;</span><br><span class="line">    <span class="keyword">didSet</span>&#123;</span><br><span class="line">        sendActionsForControlEvents(<span class="type">UIControlEvents</span>.<span class="type">ValueChanged</span>)</span><br><span class="line">        <span class="keyword">self</span>.updateApperance()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@IBInspectable</span> <span class="keyword">var</span> maxinumValue:<span class="type">Int</span> = <span class="number">0</span> &#123;</span><br><span class="line">    <span class="keyword">didSet</span>&#123;</span><br><span class="line">        <span class="keyword">self</span>.updateApperance()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@IBInspectable</span> <span class="keyword">var</span> minmumValue:<span class="type">Int</span> = <span class="number">0</span> &#123;</span><br><span class="line">    <span class="keyword">didSet</span>&#123;</span><br><span class="line">        <span class="keyword">self</span>.updateApperance()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此我们完成了一个更好用的更像<code>UIStepper</code>的自定义<code>Stepper</code>。</p>
<h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p>[1] 王巍：<a href="http://onevcat.com/2014/10/ib-customize-view/" target="_blank" rel="external">WWDC 2014 Session笔记 - 可视化开发，IB 的新时代</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/05/2015-01-05-gong-yu-shan-qi-shi-,bi-xian-li-qi-qi-wo-de-xcodecha-jian/" itemprop="url">
                  工欲善其事，必先利其器-我的XCode插件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-01-05T09:11:18+08:00" content="2015-01-05">
              2015-01-05
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/01/05/2015-01-05-gong-yu-shan-qi-shi-,bi-xian-li-qi-qi-wo-de-xcodecha-jian/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/01/05/2015-01-05-gong-yu-shan-qi-shi-,bi-xian-li-qi-qi-wo-de-xcodecha-jian/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>XCode为我们提供了一个相对完善的集成开发环境(IDE)，但它仍有诸多不便，在很多地方做的不是那么好，所幸Apple提供了插件编写功能。通过使用多种插件，可以显著提高我们的开发效率。</p>
<h3 id="KSImageNamed"><a href="#KSImageNamed" class="headerlink" title="KSImageNamed"></a><a href="https://github.com/ksuther/KSImageNamed-Xcode" target="_blank" rel="external">KSImageNamed</a></h3><p>你是否曾为<code>[UIImage imageNamed:]</code>无法准确拼出图片名称感到烦恼？是否也曾反复把图片名拷贝到代码里？是否遇到过把图片名大小写搞错而导致真机不能正常显示图片资源？那么这款神器绝对适合你，而且是完全免费的哟。经博主测试，用了<a href="https://github.com/ksuther/KSImageNamed-Xcode" target="_blank" rel="external">KSImageNamed</a>，手不酸了，眼不疼了，一口气写100行。</p>
<p><img src="https://raw.github.com/ksuther/KSImageNamed-Xcode/master/screenshot.gif" alt="Screenshot"></p>
<h3 id="VVDocumenter"><a href="#VVDocumenter" class="headerlink" title="VVDocumenter"></a><a href="https://github.com/onevcat/VVDocumenter-Xcode" target="_blank" rel="external">VVDocumenter</a></h3><p>喵神出品，必属精品。iOS开发大神<a href="http://onevcat.com/" target="_blank" rel="external">onevcat(人称喵神)</a>倾情奉献，分分钟生成API文档，与Apple Documention无缝对接，实乃SDK开发、底层API开发人员居家旅行之利器，你还在等什么！</p>
<p><img src="https://raw.github.com/onevcat/VVDocumenter-Xcode/master/ScreenShot.gif" alt="Screenshot"></p>
<h3 id="Peckham"><a href="#Peckham" class="headerlink" title="Peckham"></a><a href="https://github.com/markohlebar/Peckham" target="_blank" rel="external">Peckham</a></h3><p>拷贝代码忘记import头文件？代码写到上千行引入新类需要导入新类，<code>cmd+shift+f</code>找到这个类，拷贝头文件，然后回到原文件，滚动到顶部再导入。Peckham统统帮你搞定，<code>control+cmd+h</code>一键搞定(靠，明明是三键好不好)，麻麻再也不用担心我导入头文件。</p>
<p><img src="https://raw.githubusercontent.com/markohlebar/Peckham/develop/Misc/Peckham.gif" alt="Peckham.gif"></p>
<h3 id="Cocoapods-UI"><a href="#Cocoapods-UI" class="headerlink" title="Cocoapods-UI"></a><a href="https://github.com/kattrali/cocoapods-xcode-plugin" target="_blank" rel="external">Cocoapods-UI</a></h3><p>不要问我为什么不用酷酷的命令行，因为我懒，Cocoapods的UI工具拿去不谢。</p>
<p><img src="https://github.com/kattrali/cocoadocs-xcode-plugin/raw/master/menu.png" alt="Menu"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/17/2014-11-17-shi-yong-calayerde-maskdong-hua/" itemprop="url">
                  使用CALayer的mask动画
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-11-17T17:13:27+08:00" content="2014-11-17">
              2014-11-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS开发/" itemprop="url" rel="index">
                    <span itemprop="name">iOS开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/17/2014-11-17-shi-yong-calayerde-maskdong-hua/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/17/2014-11-17-shi-yong-calayerde-maskdong-hua/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Core Animation一直是iOS比较有意思的一个主题，使用Core Animation可以实现非常平滑的炫酷动画。Core animtion的API是较高级的封装，使用便捷，使得我们免于自己使用OpenGL实现动画。本文主要介绍如何使用CALayer的mask实现一个双向注水动画（姑且这么叫吧）。</p>
<p><img src="https://raw.githubusercontent.com/wuwen1030/blogresources/master/20141117_01.gif" alt="animation gif"></p>
<h3 id="了解CALayer的mask"><a href="#了解CALayer的mask" class="headerlink" title="了解CALayer的mask"></a>了解CALayer的mask</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* A layer whose alpha channel is used as a mask to select between the</span><br><span class="line"> * layer's background and the result of compositing the layer's</span><br><span class="line"> * contents with its filtered background. Defaults to nil. When used as</span><br><span class="line"> * a mask the layer's `compositingFilter' and `backgroundFilters'</span><br><span class="line"> * properties are ignored. When setting the mask to a new layer, the</span><br><span class="line"> * new layer must have a nil superlayer, otherwise the behavior is</span><br><span class="line"> * undefined. Nested masks (mask layers with their own masks) are</span><br><span class="line"> * unsupported. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">strong</span>) <span class="built_in">CALayer</span> *mask;</span><br></pre></td></tr></table></figure>
<p>以上是<code>CALayer</code>的头文件关于<code>mask</code>的说明，<code>mask</code>实际上<code>layer</code>内容的一个遮罩，如果我们把<code>mask</code>是透明的，实际看到的layer是完全透明的，也就是说只有mask的内容不透明的部分和<code>layer</code>叠加的部分才会显示出来，效果如下：</p>
<p><img src="https://raw.githubusercontent.com/wuwen1030/blogresources/master/20141117_02.jpg" alt="Layer mask"></p>
<h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><p>设计的思路参考<a href="http://www.iwangke.me/2014/10/06/how-to-implement-a-core-animation-based-60-fps-ktv-lyrics-view/" target="_blank" rel="external">《基于Core Animation的KTV歌词视图的平滑实现》</a>，<a href="https://github.com/facebook/Shimmer" target="_blank" rel="external">Facebook Shimmer</a>。</p>
<p><img src="https://raw.githubusercontent.com/wuwen1030/blogresources/master/20141117_03.jpg" alt="flow"><br>在<code>View</code>上重叠放置两个<code>UIImageView</code>: <code>grayHead</code>&amp;<code>greenHead</code>，默认<code>greenHead</code>会遮挡住<code>grayHead</code>。为<code>greenHead</code>设置一个<code>mask</code>，这个mask不是普通的<code>mask</code>，它由两个<code>subLayer</code>:<code>maskLayerUp``maskLayerDown</code>组成。默认情况下，<code>subLayer</code>都显示在<code>mask</code>内容之外，此时<code>mask</code>实际上透明的，由此<code>greenHead</code>也是透明的。现在我们希望<code>greenHead</code>从左上角和右下角慢慢显示内容，那么我们只需要从两个方向为<code>greenHead</code>填充内容就可以了。</p>
<p>###代码片段</p>
<ul>
<li>创建<code>mask</code></li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">CALayer</span> *)greenHeadMaskLayer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CALayer</span> *mask = [<span class="built_in">CALayer</span> layer];</span><br><span class="line">    mask.frame = <span class="keyword">self</span>.greenHead.bounds;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.maskLayerUp = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.maskLayerUp.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">30.0</span>f, <span class="number">30.0</span>f);</span><br><span class="line">    <span class="keyword">self</span>.maskLayerUp.fillColor = [<span class="built_in">UIColor</span> greenColor].CGColor; <span class="comment">// Any color but clear will be OK</span></span><br><span class="line">    <span class="keyword">self</span>.maskLayerUp.path = [<span class="built_in">UIBezierPath</span> bezierPathWithArcCenter:<span class="built_in">CGPointMake</span>(<span class="number">15.0</span>f, <span class="number">15.0</span>f)</span><br><span class="line">                                                           radius:<span class="number">15.0</span>f</span><br><span class="line">                                                       startAngle:<span class="number">0</span></span><br><span class="line">                                                         endAngle:<span class="number">2</span>*M_PI</span><br><span class="line">                                                        clockwise:<span class="literal">YES</span>].CGPath;</span><br><span class="line">    <span class="keyword">self</span>.maskLayerUp.opacity = <span class="number">0.8</span>f;</span><br><span class="line">    <span class="keyword">self</span>.maskLayerUp.position = <span class="built_in">CGPointMake</span>(<span class="number">-5.0</span>f, <span class="number">-5.0</span>f);</span><br><span class="line">    [mask addSublayer:<span class="keyword">self</span>.maskLayerUp];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.maskLayerDown = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">    <span class="keyword">self</span>.maskLayerDown.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">30.0</span>f, <span class="number">30.0</span>f);</span><br><span class="line">    <span class="keyword">self</span>.maskLayerDown.fillColor = [<span class="built_in">UIColor</span> greenColor].CGColor; <span class="comment">// Any color but clear will be OK</span></span><br><span class="line">    <span class="keyword">self</span>.maskLayerDown.path = [<span class="built_in">UIBezierPath</span> bezierPathWithArcCenter:<span class="built_in">CGPointMake</span>(<span class="number">15.0</span>f, <span class="number">15.0</span>f)</span><br><span class="line">                                                             radius:<span class="number">15.0</span>f</span><br><span class="line">                                                         startAngle:<span class="number">0</span></span><br><span class="line">                                                           endAngle:<span class="number">2</span>*M_PI</span><br><span class="line">                                                          clockwise:<span class="literal">YES</span>].CGPath;</span><br><span class="line">    <span class="keyword">self</span>.maskLayerDown.position = <span class="built_in">CGPointMake</span>(<span class="number">35.0</span>f, <span class="number">35.0</span>f);</span><br><span class="line">    [mask addSublayer:<span class="keyword">self</span>.maskLayerDown];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mask;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>做动画</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)startGreenHeadAnimation</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *downAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">    downAnimation.fromValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">-5.0</span>f, <span class="number">-5.0</span>f)];</span><br><span class="line">    downAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">10.0</span>f, <span class="number">10.0</span>f)];</span><br><span class="line">    downAnimation.duration = duration;</span><br><span class="line">    [<span class="keyword">self</span>.maskLayerUp addAnimation:downAnimation forKey:<span class="string">@"downAnimation"</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CABasicAnimation</span> *upAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">    upAnimation.fromValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">35.0</span>f, <span class="number">35.0</span>f)];</span><br><span class="line">    upAnimation.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">20.0</span>f, <span class="number">20.0</span>f)];</span><br><span class="line">    upAnimation.duration = duration;</span><br><span class="line">    [<span class="keyword">self</span>.maskLayerDown addAnimation:upAnimation forKey:<span class="string">@"upAnimation"</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><a href="https://github.com/wuwen1030/CALayerAnimationDemo" target="_blank" rel="external">完整代码</a></strong></p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><code>CALayer</code>提供另外一种操作UI的手段，虽然它提供的API比<code>UIView</code>较底层，但它能提供更加丰富的功能和更高的性能(<code>CALayer</code>的动画是在专门的线程渲染的)。涉及到复杂且性能要求高的UI界面，<code>CALayer</code>的作用就比较明显了，比如<a href="https://github.com/facebook/AsyncDisplayKit" target="_blank" rel="external">AsyncDisplayKit</a>。<s>通过本片文章，我们其实也能看出<code>CALayer</code>的一个用处，通常我们处理圆角时会直接去修改<code>CALayer</code>的<code>cornerRadius</code>，但这种做法性能比较差，尤其是放在列表里的时候，现在我们有了<code>mask</code>，这样我们可以直接改变<code>layer</code>的<code>mask</code>，而不会影响到图形渲染的性能。</s>(这里是严重错误的)</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/12/2014-11-12-yong-octopressxie-bo-ke/" itemprop="url">
                  用Octopress写博客
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-11-12T16:14:34+08:00" content="2014-11-12">
              2014-11-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/非技术类/" itemprop="url" rel="index">
                    <span itemprop="name">非技术类</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/12/2014-11-12-yong-octopressxie-bo-ke/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/12/2014-11-12-yong-octopressxie-bo-ke/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>从昨天晚上折腾到现在终于把Octopress的环境搭好了，网上有很多搭建环境的例子，无奈有些说的不是很明确，东拼西凑了一些教程，这些都非本人原创，把我的经历给大家分享下，让大家少走弯路。</p>
<p>最近产生了写博客的想法，一方面想把自己的开发经历和技术经验分享出来，另一方面也希望在写作的过程中能加深自己的了解。个人比较喜欢<a href="http://onevcat.com/" target="_blank" rel="external">喵神</a>和<a href="http://blog.devtang.com/" target="_blank" rel="external">唐巧</a>的技术博客的风格，喵神的Blog模板没有尝试，主要参考唐巧的<a href="http://blog.devtang.com/blog/2012/02/10/setup-blog-based-on-github/" target="_blank" rel="external">文章</a>，完成了本文的写作环境的搭建。</p>
<h3 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h3><p>搭建环境主要参考这里<a href="http://blog.devtang.com/blog/2012/02/10/setup-blog-based-on-github/" target="_blank" rel="external">http://blog.devtang.com/blog/2012/02/10/setup-blog-based-on-github/</a>，大家直接跳过去看就好了。主要说说我的经验，ruby的环境不需要1.9.3的，Yosemite默认的2.0是Ok的，所以没必要纠结地去装gcc 4.2，直接装Octopress就行。<code>gem install bundler</code>相当地慢，曾经就因为这个放弃了一次，这个没被墙，就是慢，耐心等一下。</p>
<p>文章里漏掉的一点就是设置octopress与github-pages的连接，第一次发布，在执行<code>rake deploy</code>之前，要先执行<code>rake setup_github_pages</code>，在输入提示中输入你的github-pages地址，比如我的<code>git@github.com:wuwen1030/wuwen1030.github.io.git</code>。大家在配置好，最好就不要手动去改github-pages的内容啦，这可能会导致发布失败噢，原因就是octopress的发布内容和github服务端的内容不一致造成的，deploy 时明明看到 git pull… 了，没搞懂，大家如果知道请指教一下。</p>
<p>deploy之后，发现和大神的Blog还是很不一样嘛，不知道从哪儿窜出来的各种英文，现在需要配置一下，定制自己的模板啦。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>唐巧的文章配置这块写的不是太细，谷歌，DuckDuckGo被各种屏蔽，只好求助度娘，配置主要是参考<a href="http://www.cnblogs.com/oec2003/archive/2013/05/31/3109577.html" target="_blank" rel="external">http://www.cnblogs.com/oec2003/archive/2013/05/31/3109577.html</a>。大家自行阅读吧，写的很细了。配置这块还有很多可研究的，待以后深入研究再补充上来。</p>
<p>至此，你已经得到了一个看起来很酷的blog模板了，可以拿出来装一装了（Octopress号称就是给Hacker用的么），唯一的问题就是访问速度很慢，不过没关系，已经有解决方案了，拿来主义的博主再次发出链接大招<a href="http://blog.devtang.com/blog/2014/06/02/use-gitcafe-to-host-blog/" target="_blank" rel="external">http://blog.devtang.com/blog/2014/06/02/use-gitcafe-to-host-blog/</a>，一步步按照文章里的来，像我这样的小白也能搞好。感谢方校长的GFW成功阻击境外反动势力对我国的渗透，即使切到GitCafe你的Blog访问速度依然很慢，查看你主页的源码，你会看到这个：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;link href=<span class="string">"//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"</span> rel=<span class="string">"stylesheet"</span> type=<span class="string">"text/css"</span>&gt;</span><br><span class="line">&lt;link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"&gt;</span><br></pre></td></tr></table></figure>
<p>问题就在这里，替换掉Google的jquery和font链接，打开/source/index.html，做如下替换：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 替换jquery ajax.googleapis.com/ajax/libs/jquery/<span class="number">1.9</span><span class="number">.1</span>/jquery.min.js--&gt;</span><br><span class="line">&lt;script src="http://ajax.useso.com/ajax/libs/jquery/1.9.1/jquery.min.js"&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>打开 source/_includes/custom/head.html，替换成如下代码:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--Fonts from Google"s Web font directory at http://google.com/webfonts --&gt;</span><br><span class="line">&lt;link href="http://fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"&gt;</span><br><span class="line">&lt;link href="http://fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"&gt;</span><br></pre></td></tr></table></figure>
<h3 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h3><p>完成这些之后，你就可以像博主一样使用优雅的<strong>Markdown</strong>在这写作，推荐一个不错的Mac开源<a href="http://macdown.uranusjr.com/" target="_blank" rel="external">Markdown编辑工具</a>。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="BenXia" />
          <p class="site-author-name" itemprop="name">BenXia</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/wuwen1030" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        
        <div class="links-of-blogroll motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BenXia</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"wuwen1030"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  


</body>
</html>
